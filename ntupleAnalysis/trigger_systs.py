import numpy as np
#for full 2016 Legacy dataset.  Trigger scale factors for use without HLT applied in MC

def getTrgSF2016(r9, abs_eta, pt, order, year, shift):

    if order == 0:

        # leading/seeded photon
        ptBounds = np.array([0.0, 33.3333, 35.0, 40.0, 45.0, 50.0, 60.0, 70.0, 90.0, 99999999.])
        ib = np.argwhere(pt > ptBounds)[-1]

        if r9 < 0.54:
            #seeded leg, R9 turn-on (0.50-0.54), cat2, barrel
            SFs = [
                0.59825812412,
                0.653756261564,
                0.683431664312,
                0.710022589532,
                0.730570707514,
                0.751603284508,
                0.788168324479,
                0.827941857065,
                0.783051501808
                ]
            Uncerts = [
                (0.00402725234934, 0.00402725234934),
                (0.0099055319024, 0.0099055319024),
                (0.00554805412963, 0.00554805412963),
                (0.00532044177457, 0.00532044177457),
                (0.00371231458923, 0.00371231458923),
                (0.0096076672755, 0.0096076672755),
                (0.0224762460948, 0.0224762460948),
                (0.0252561959982, 0.0252561959982),
                (0.0585125120425, 0.0585125120425)
                ]
        elif (0.54 <= r9) and (r9 < 0.85):
            #seeded leg, R9 plateau (0.54-0.85), cat2, barrel
            SFs = [
                0.895998413691,
                0.953053304133,
                0.963043242302,
                0.968461390346,
                0.972040191424,
                0.974762665083,
                0.980444525098,
                0.985215654176,
                0.990441809012,
                ]
            Uncerts = [
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.00109371653612, 0.00109371653612),
                (0.001, 0.001),
                (0.00116568181032, 0.00116568181032)
                ]
        elif r9 >= 0.85:
            #seeded leg, cat0 (R9>0.85), barrel
            SFs = [
                0.913564877899,
                0.970947331321,
                0.976527980646,
                0.981419518931,
                0.985854458442,
                0.986833495137,
                0.985750212762,
                0.989860818686,
                0.992375919183
            ]
            Uncerts = [
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001)
            ]
        else:
            raise Exception('Unknown r9: %f'%r9)

    elif order == 1:

        # subleading/unseeded photon
        ptBounds = np.array([0.0, 22.5, 25.0, 27.5, 30.0, 32.5, 35.0, 40.0, 45.0, 50.0, 60.0, 70.0, 90.0, 99999999.])
        ib = np.argwhere(pt > ptBounds)[-1]

        if r9 < 0.54:
            #unseeded leg, R9 turn-on (0.50-0.54), cat2, barrel
            SFs = [
                0.603067311807,
                0.624492850153,
                0.648788979569,
                0.654133439859,
                0.676589314263,
                0.683202863128,
                0.704606499829,
                0.732923798151,
                0.755447011273,
                0.770751155231,
                0.790198511256,
                0.833694375128,
                0.795746634733,
                ]
            Uncerts = [
                (0.00796165968882, 0.00796165968882),
                (0.00926893494893, 0.00926893494893),
                (0.00643750002229, 0.00643750002229),
                (0.00560733004707, 0.00560733004707),
                (0.00478261673364, 0.00478261673364),
                (0.00602767084288, 0.00602767084288),
                (0.00491050256218, 0.00491050256218),
                (0.00526686396656, 0.00526686396656),
                (0.00360816189604, 0.00360816189604),
                (0.00941141936066, 0.00941141936066),
                (0.0221609073824, 0.0221609073824),
                (0.0245645104497, 0.0245645104497),
                (0.061430899873, 0.061430899873)
                ]
        elif (0.54 <= r9) and (r9 < 0.85):
            #unseeded leg, R9 plateau (0.54-0.85), cat2, barrel
            SFs = [
                0.985693698514,
                0.98720784946,
                0.990136850966,
                0.990703680436,
                0.991401108045,
                0.991139606368,
                0.990594834177,
                0.992264476341,
                0.99215428945,
                0.991657615297,
                0.992376937273,
                0.99132752396,
                0.992327711897,
                ]
            Uncerts = [
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001)
                ]
        elif r9 >= 0.85:
            #unseeded leg, cat0 (R9>0.85), barrel
            SFs = [
                0.991761096067,
                0.99209301576,
                0.995650862874,
                0.997325955916,
                0.99777623069,
                0.998034021176,
                0.998504649133,
                0.999197866395,
                0.999484680768,
                0.999525695621,
                0.999489148388,
                0.999586900113,
                0.99976876111,
                ]
            Uncerts = [
                (0.00255160879609, 0.00255160879609),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001),
                (0.001, 0.001)
                ]

    else:
        raise Exception('Unknown order: %s'%str(order))

    #print(np.array(SFs).shape)
    #print(np.array(SFs)[ib])
    #print(np.array(Uncerts).shape)
    #print(np.array(Uncerts)[ib])
    #print(np.array(Uncerts)[ib][0][0])
    #print(np.array(Uncerts)[ib][0][1])
    sf = np.array(SFs)[ib][0]
    err_lo = np.array(Uncerts)[ib][0][0]
    err_hi = np.array(Uncerts)[ib][0][1]
    if shift == 'nom':
        return sf
    elif shift == 'dn':
        return sf*(1.-err_lo)
    elif shift == 'up':
        return sf*(1.+err_hi)
    else:
        raise Exception('Unknown trg SF syst shift: %s'%shift)

#def getTrgSF(r9, abs_eta, pt, order, year='2016', shift='nom'):
#
#    if order == 0:
#        return getTrgSF2016_lead(r9, abs_eta, pt, year, shift)
#    elif order == 1:
#        return getTrgSF2016_sublead(r9, abs_eta, pt, year, shift)
#    else:
#        raise Exception('Unknown pt order: %d'%order)
#
#
##getTrgSF(r9=0.9, abs_eta=1.4, pt=20., order=1, year='2016')
##getTrgSF(r9=0.5, abs_eta=1.4, pt=100., order=1, year='2016')
#getTrgSF(r9=0.54, abs_eta=1.4, pt=100., order=0, year='2016')
